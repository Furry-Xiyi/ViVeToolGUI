<Page
    x:Class="ViVeToolGUI.QueryPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:ViVeToolGUI"
    xmlns:muxc="using:Microsoft.UI.Xaml.Controls">

    <Page.Resources>
        <!-- Optimized ListViewItem Style -->
        <Style x:Key="FeatureListViewItemStyle" TargetType="ListViewItem">
            <Setter Property="Padding" Value="0"/>
            <Setter Property="Margin" Value="0"/>
            <Setter Property="MinHeight" Value="0"/>
            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
        </Style>
    </Page.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <StackPanel Grid.Row="0" Padding="40,40,40,20" Spacing="16">
            <TextBlock x:Uid="Query_Title" 
                      Style="{StaticResource TitleTextBlockStyle}"/>

            <TextBlock x:Uid="Query_Description" 
                      Style="{StaticResource BodyTextBlockStyle}"
                      TextWrapping="Wrap"
                      Opacity="0.7"/>

            <StackPanel Orientation="Horizontal" Spacing="12">
                <Button x:Name="QueryAllButton" 
                       x:Uid="Query_QueryAllButton"
                       Style="{StaticResource AccentButtonStyle}"
                       Click="QueryAllButton_Click">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE721;" FontSize="16"/>
                        <TextBlock x:Uid="Query_QueryAllButtonText"/>
                    </StackPanel>
                </Button>

                <Button x:Name="ExportButton" 
                       x:Uid="Query_ExportButton"
                       Click="ExportButton_Click"
                       IsEnabled="False">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE74E;" FontSize="16"/>
                        <TextBlock x:Uid="Query_ExportButtonText"/>
                    </StackPanel>
                </Button>

                <TextBox x:Name="SearchBox" 
                        x:Uid="Query_SearchBox"
                        Width="300"
                        TextChanged="SearchBox_TextChanged"/>
            </StackPanel>
        </StackPanel>

        <Grid Grid.Row="1" Padding="40,0,40,40">
            <Border BorderThickness="1" 
                   BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                   Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                   CornerRadius="8">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Header - 调整垂直对齐和高度 -->
                    <Grid Grid.Row="0"
                         Padding="12,8,12,8" 
                         Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}"
                         ColumnSpacing="12"
                         Height="44">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="120"/>
                            <ColumnDefinition Width="150"/>
                            <ColumnDefinition Width="150"/>
                            <ColumnDefinition Width="120"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Column="0" 
                                  x:Uid="Query_HeaderID" 
                                  FontWeight="SemiBold"
                                  VerticalAlignment="Center"/>
                        <TextBlock Grid.Column="1" 
                                  x:Uid="Query_HeaderPriority" 
                                  FontWeight="SemiBold"
                                  VerticalAlignment="Center"/>
                        <TextBlock Grid.Column="2" 
                                  x:Uid="Query_HeaderState" 
                                  FontWeight="SemiBold"
                                  VerticalAlignment="Center"/>
                        <TextBlock Grid.Column="3" 
                                  x:Uid="Query_HeaderType" 
                                  FontWeight="SemiBold"
                                  VerticalAlignment="Center"/>
                        <TextBlock Grid.Column="4" 
                                  x:Uid="Query_HeaderName" 
                                  FontWeight="SemiBold"
                                  VerticalAlignment="Center"/>
                    </Grid>

                    <!-- ListView -->
                    <ListView Grid.Row="1"
          x:Name="FeaturesListView"
          SelectionMode="Extended"
          IsItemClickEnabled="False"
          ItemContainerStyle="{StaticResource FeatureListViewItemStyle}"
          VerticalAlignment="Stretch"
          HorizontalAlignment="Stretch"
          ScrollViewer.VerticalScrollMode="Enabled"
          ScrollViewer.VerticalScrollBarVisibility="Auto"
          ScrollViewer.HorizontalScrollMode="Disabled"
          ScrollViewer.HorizontalScrollBarVisibility="Disabled"
          IsTabStop="True">
                        <ListView.ItemsPanel>
                            <ItemsPanelTemplate>
                                <ItemsStackPanel Orientation="Vertical" />
                            </ItemsPanelTemplate>
                        </ListView.ItemsPanel>

                        <ListView.ItemTemplate>
                            <DataTemplate x:DataType="local:FeatureInfo">
                                <Grid Padding="12,6,12,6" ColumnSpacing="12" Height="32" Background="Transparent">
                                    <Grid.ContextFlyout>
                                        <MenuFlyout>
                                            <MenuFlyoutItem Text="Enable Feature"
                                        Click="EnableFeature_Click"
                                        CommandParameter="{x:Bind}">
                                                <MenuFlyoutItem.Icon>
                                                    <FontIcon Glyph="&#xE73A;" FontSize="16"/>
                                                </MenuFlyoutItem.Icon>
                                            </MenuFlyoutItem>

                                            <MenuFlyoutItem Text="Disable Feature"
                                        Click="DisableFeature_Click"
                                        CommandParameter="{x:Bind}">
                                                <MenuFlyoutItem.Icon>
                                                    <FontIcon Glyph="&#xF16E;" FontSize="16"/>
                                                </MenuFlyoutItem.Icon>
                                            </MenuFlyoutItem>

                                            <MenuFlyoutSeparator/>

                                            <MenuFlyoutItem Text="Copy Feature ID"
                                        Click="CopyFeatureId_Click"
                                        CommandParameter="{x:Bind}">
                                                <MenuFlyoutItem.Icon>
                                                    <FontIcon Glyph="&#xE8C8;" FontSize="16"/>
                                                </MenuFlyoutItem.Icon>
                                            </MenuFlyoutItem>
                                        </MenuFlyout>
                                    </Grid.ContextFlyout>

                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="120"/>
                                        <ColumnDefinition Width="150"/>
                                        <ColumnDefinition Width="150"/>
                                        <ColumnDefinition Width="120"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Column="0" Text="{x:Bind Id}" FontFamily="Consolas" VerticalAlignment="Center" FontSize="13"/>
                                    <TextBlock Grid.Column="1" Text="{x:Bind Priority}" VerticalAlignment="Center" FontSize="13"/>
                                    <TextBlock Grid.Column="2" Text="{x:Bind State}" VerticalAlignment="Center" FontSize="13"/>
                                    <TextBlock Grid.Column="3" Text="{x:Bind Type}" VerticalAlignment="Center" FontSize="13"/>
                                    <TextBlock Grid.Column="4" Text="{x:Bind Name}" VerticalAlignment="Center" TextTrimming="CharacterEllipsis" FontSize="13"/>
                                </Grid>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </Grid>
            </Border>
        </Grid>

        <!-- Loading Overlay -->
        <Border x:Name="LoadingOverlay"
                Grid.RowSpan="2"
                Background="#66000000"
                CornerRadius="8"
                Visibility="Collapsed">
            <StackPanel HorizontalAlignment="Center" 
                       VerticalAlignment="Center"
                       Spacing="16">
                <ProgressRing IsActive="True" Width="60" Height="60"/>
                <TextBlock x:Name="LoadingText"
                          Text="Loading..."
                          HorizontalAlignment="Center"
                          FontSize="14"
                          Opacity="0.8"/>
            </StackPanel>
        </Border>
    </Grid>
</Page>